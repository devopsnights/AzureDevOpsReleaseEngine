parameters:
  - name: azureServiceConnection
    type: string
  - name: bicepFilePath
    type: string

steps:
  
  - powershell: |
      Write-Host "Service Connection: ${{ parameters.azureServiceConnection }}"

      $file = $env:bicepFilePath
      New-Item -ItemType Directory -Force -Path $(build.artifactstagingdirectory)/infrastructure
      az bicep build --file $file --outdir $(build.artifactstagingdirectory)/infrastructure      
    env:
          bicepFilePath: ${{ parameters.bicepFilePath }}
  
  # - task: AzureCLI@2  
  #   displayName: 'Build bicep artifact' 
  #   inputs: 
  #     azureSubscription: ${{ parameters.azureServiceConnection }}
  #     scriptType: 'pscore'  
  #     scriptLocation: 'inlineScript'  
  #     inlineScript: |
  #       $file = $env:bicepFilePath
  #       New-Item -ItemType Directory -Force -Path $(build.artifactstagingdirectory)/infrastructure
  #       az bicep build --file $file --outdir $(build.artifactstagingdirectory)/infrastructure
  #   env:
  #       bicepFilePath: ${{ parameters.bicepFilePath }}